---
toc: true
title:  "ComfyUI で FLUX.2 [klein] を試してみる"
date:   2026-01-25 09:00:00 +0900
categories: プログラム
tags:
- python
- 機械学習
- ComfyUI
- flux.2
---
以前 black forest labs の [FLUX.1][flux1] を試してみましたが、そちらの別バージョン的なモデル FLUX.2 がリリースされていました。FLUX.2 も様々なバリエーションがリリースされていますが、今回はローカル実行もしやすい軽量モデルの 「klein」を試してみます。

[FLUX.2 [klein]][klein]

# 概要
* ComfyUI で生成できました
* 2026/1/25 時点では、ComfyUI を Nightly 版にしないと生成に失敗します
* GeForce RTX 2070 (VRAM 8GB) でも生成できました
* 1 枚生成するのに Distilled モデルだと 10 秒少し、ベースモデルでも 70 秒ほどで生成できました

# 準備
## ComfyUI を更新する
[ComfyUI を docker compose で構築する][comfyui] で用意した Docker Compose の環境を使います。ただ、FLUX.2 \[klein\] を使うには、Nightly 版を使う必要があります。今回使用する環境は Git で ComfyUI のコードをダウンロードしているため、以下のようにコマンドを実行してコードを最新化します。

``` bash
cd ComfyUI/
git pull origin master
cd ..
```

ComfyUI の再起動だとうまく反映されなかったので、ComfyUI を実行するコンテナを再起動する必要がありました。カスタムノードの追加は特段必要ないようです。

## ワークフロー & モデルのダウンロード
FLUX.2 \[klein\] のワークフローは、ComfyUI 上で取得できます。ComfyUI が開いたら左側メニューより「Template」をクリックします。

![template][img01]

開いたウインドウの上部にある検索ボックスに「FLUX.2」と入力します。FLUX.2 向けのワークフローが表示されますが、今回は「Flux.2 \[Klein\] 4B: Text to Image」をクリックします。

すると ComfyUI にワークフローが読み込まれます。いくつか Missing models が表示されるかと思いますが、これからダウンロードするので無視して OK です。モデルのダウンロードについては、読み込んだワークフローの左端に説明があります。

![Model links][img02]

text_encoders と vae はこのリンクからダウンロードしたモデルで問題ないのですが、diffusion_models については VRAM が厳しいので FP8 版を使いました。これは以下の Hugging Face からダウンロードできます。

[black-forest-labs/FLUX.2-klein-base-4b-fp8][klein-fp8-base]

[black-forest-labs/FLUX.2-klein-4b-fp8][klein-fp8]

ダウンロードしたファイルを、上記 Model links に記載のあるフォルダ構成 (ComfyUI/models 配下の各フォルダ) へ配置します。diffusion_models は FP8 版を使うので、少しファイル名は異なりますが配置先はこの通りにします。


# 実行
あとは実行するだけ・・・なのですが、ワークフローは Base 用と Distilled の二種類のワークフローがあります。どちらで生成したいかに応じて、不要な方を bypass させる必要がある点に注意が必要です。

![workflow][img03]

上図で青丸で囲んだフローが Base 用、赤丸で囲んだのが Distilled のフローです。なので、この場合は Distilled のフロー (赤丸で囲んだ側) が bypass される色になっているので、Base モデルで生成を行います。Distilled のフローにしたい場合は、ノードを右クリックして「bypass」をクリックします。

![bypass][img04]

これでどちらを bypass するか切り替えて実行する形です。

![distilled][img05]

このようになっていれば、Distilled モデルで生成される形です。


## Base モデルの出力例
![base][img07]

Base モデルで生成すると、こちらの絵が出力されるまで 69.29 秒かかりました。

## Distilled モデルの出力例
![distilled][img08]

同じプロンプトで Distilled モデルの場合は生成に 13.06 秒かかりました。


[flux1]:{% post_url 2024/2024-08-18-flux1 %}
[comfyui]:{% post_url 2024/2024-09-05-comfyui-compose %}

[klein]:https://bfl.ai/models/flux-2-klein
[klein-fp8-base]:https://huggingface.co/black-forest-labs/FLUX.2-klein-base-4b-fp8/resolve/main/flux-2-klein-base-4b-fp8.safetensors
[klein-fp8]:https://huggingface.co/black-forest-labs/FLUX.2-klein-4b-fp8/resolve/main/flux-2-klein-4b-fp8.safetensors

[img01]:/assets/images/2026/01/ss-20260125-01.png
[img02]:/assets/images/2026/01/ss-20260125-02.png
[img03]:/assets/images/2026/01/ss-20260125-03.png
[img04]:/assets/images/2026/01/ss-20260125-04.png
[img05]:/assets/images/2026/01/ss-20260125-05.png
[img07]:/assets/images/2026/01/ss-20260125-07.png
[img08]:/assets/images/2026/01/ss-20260125-08.png
